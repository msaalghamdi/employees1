<style>
  .risk-high { color: #c62828; font-weight: bold; border: 2px solid #c62828; padding: 10px; }
  .risk-low { color: #2e7d32; }
  .row:hover { background-color: #f1f1f1; cursor: pointer; }
  input[type="checkbox"] { transform: scale(1.5); }
</style>

<script>
function calc() {
    let t = 0;
    document.querySelectorAll("#table input:checked").forEach(c => t += Number(c.dataset.w));
    
    const totalEl = document.getElementById("total");
    totalEl.innerText = t;

    if (t >= 80) {
        totalEl.className = "risk-high";
        document.getElementById("rec").value = "عدم صحة علاقة العمل";
    } else {
        totalEl.className = "risk-low";
        document.getElementById("rec").value = "صحة علاقة العمل";
    }
}

// تحسين وظيفة التصدير لتكون أكثر مرونة
function exportExcel() {
    // التحقق من البيانات الأساسية
    if(!document.getElementById("empName").value) {
        alert("يرجى إدخال اسم العامل قبل التصدير");
        return;
    }

    const data = [
        ["تقرير تقييم التوطين"],
        ["اسم العامل", document.getElementById("empName").value, "رقم الهوية", document.getElementById("empId").value],
        ["رقم السجل", document.getElementById("crNum").value, "رقم المنشأة", document.getElementById("hrsdNum").value],
        ["النتيجة النهائية", document.getElementById("rec").value, "إجمالي النقاط", document.getElementById("total").innerText + "%"],
        [],
        ["م", "المؤشر", "الوزن", "النتيجة"]
    ];

    criteria.forEach((c, i) => {
        const checked = document.querySelectorAll("#table input")[i].checked ? "متحقق" : "غير متوفر";
        data.push([i + 1, c[0], c[1] + "%", checked]);
    });

    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "التقرير");
    XLSX.writeFile(wb, `تقرير_${document.getElementById("empName").value}.xlsx`);
}
</script>
